<!DOCTYPE html><html lang="en"><head><title>src/HeaderResizer</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/HeaderResizer"><meta name="groc-project-path" content="src/HeaderResizer.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/HeaderResizer.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Copyright 2020 Ulrich Gaal</p>
<p>Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<pre><code>http://www.apache.org/licenses/LICENSE-2.0</code></pre>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> React, { useCallback, useContext, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> PropTypes <span class="hljs-keyword">from</span> <span class="hljs-string">'prop-types'</span>
<span class="hljs-keyword">import</span> { ColumnType, LayoutType } <span class="hljs-keyword">from</span> <span class="hljs-string">'./prop-types'</span>
<span class="hljs-keyword">import</span> {
  ResizerContext,
  START_RESIZING,
  END_RESIZING,
  RESIZE
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducers/resizerReducer'</span>
<span class="hljs-keyword">import</span> { DEFAULT_MIN_WIDTH, ConfigContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Table'</span>
<span class="hljs-keyword">import</span> { measureCols } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>
<span class="hljs-keyword">import</span> { TableDispatch, COLUMN_RESIZING } <span class="hljs-keyword">from</span> <span class="hljs-string">'./actions'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./HeaderResizer.css'</span>

const HeaderResizer = props =&gt; {
  const {
    index,
    column,
    layout: { rule }
  } = props
  const { id, minWidth = DEFAULT_MIN_WIDTH } = column
  const [timeStamp, setTimeStamp] = useState(0)
  const resizerDispatch = useContext(ResizerContext)
  const dispatch = useContext(TableDispatch)
  const { rowIdAttr, context } = useContext(ConfigContext)

  const handleAutoresize = useCallback(
    event =&gt; {
      const { minWidth = DEFAULT_MIN_WIDTH } = column
      const columns = [{ ...column, autoresize: true, index, minWidth }]
      const section = event.target.closest(<span class="hljs-string">'.rrt-section'</span>)
      if (section) {
        const metrics = measureCols(
          context,
          columns,
          section,
          section.classList.contains(<span class="hljs-string">'rrt-section-scrollable'</span>) ? <span class="hljs-string">''</span> : rowIdAttr
        )
        metrics.forEach(metric =&gt; {
          const {
            column: { id, width }
          } = metric
          if (metric.width !== width) {
            dispatch({ type: COLUMN_RESIZING, id, width: metric.width })
          }
        })
      }
    },
    [rowIdAttr, index, context, dispatch]
  )

  const handleResize = useCallback(
    event =&gt; {
      event.stopPropagation()
      event.preventDefault()
      const table = event.target.closest(<span class="hljs-string">'.rrt-container'</span>)
      const { left } = table.getBoundingClientRect()
      const x0 = event.clientX - left
      let x1
      let clampedWidth</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>current column width</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">const</span> { width } = event.target.closest(<span class="hljs-string">'.rrt-th'</span>).getBoundingClientRect()
      resizerDispatch({ type: START_RESIZING, x: x0 })
      <span class="hljs-keyword">const</span> handlers = {
        handleMouseMove: event =&gt; {
          event.stopPropagation()
          event.preventDefault()
          <span class="hljs-keyword">const</span> dx = event.clientX - left - x0
          clampedWidth = <span class="hljs-built_in">Math</span>.max(minWidth, width + dx)
          x1 = x0 + clampedWidth - width
          resizerDispatch({ type: RESIZE, x: x1 })
        },
        handleMouseUp: event =&gt; {
          event.stopPropagation()
          event.preventDefault()
          <span class="hljs-built_in">window</span>.removeEventListener(
            <span class="hljs-string">'mousemove'</span>,
            handlers.handleMouseMove,
            <span class="hljs-literal">true</span>
          )
          <span class="hljs-built_in">window</span>.removeEventListener(<span class="hljs-string">'mouseup'</span>, handlers.handleMouseUp, <span class="hljs-literal">true</span>)
          rule.style.width = <span class="hljs-string">`<span class="hljs-subst">${clampedWidth}</span>px`</span>
          resizerDispatch({ type: END_RESIZING, id, width: clampedWidth })
        }
      }</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Position mouse handlers to create a modal drag loop</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'mousemove'</span>, handlers.handleMouseMove, <span class="hljs-literal">true</span>)
      <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'mouseup'</span>, handlers.handleMouseUp, <span class="hljs-literal">true</span>)
    },
    [id, rule, minWidth, resizerDispatch]
  )</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Dispatch event between resize and autoresize handlers based on
whether the user has made a single or double click</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> handleMouseDown = useCallback(
    event =&gt; {
      <span class="hljs-keyword">const</span> dt = event.timeStamp - timeStamp
      <span class="hljs-keyword">if</span> (dt &lt; <span class="hljs-number">500</span>) {
        handleAutoresize(event)
      } <span class="hljs-keyword">else</span> {
        setTimeStamp(event.timeStamp)
        handleResize(event)
      }
    },
    [timeStamp]
  )
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">className</span>=<span class="hljs-value">'rrt-header-resizer'</span> <span class="hljs-attribute">onMouseDown</span>=<span class="hljs-value">{handleMouseDown}</span> /&gt;</span>
}

HeaderResizer.propTypes = {
  index: PropTypes.number,
  column: ColumnType,
  layout: LayoutType
}

export default HeaderResizer
</span></div></div></div></div></body></html>